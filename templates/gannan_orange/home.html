{% extends 'base.html' %}
{% load static %}

{% block title %}智慧农业门户 - 赣南脐橙产业平台{% endblock %}

{% block extra_css %}
    <style>
        .hover-grow {
            transition: transform 0.3s ease;
        }

        .hover-grow:hover {
            transform: scale(1.02);
        }

        .list-group-item-action {
            transition: all 0.3s ease;
        }

        .list-group-item-action:hover {
            transform: translateX(10px);
            border-left: 4px solid #28a745;
        }

        .weather-alert {
            border-left: 4px solid #ffc107;
        }
    </style>
{% endblock %}

{% block main %}
    <div class="container my-4">
        <!-- 核心数据看板 -->
        <div class="row row-cols-2 row-cols-md-3 g-4 mb-4">
            <div class="col">
                <div class="card border-success shadow-sm hover-grow">
                    <div class="card-body text-center py-4">
                        <h2 class="text-success mb-0">{{ total_variety }}</h2>
                        <small class="text-muted">总品种数</small>
                        <i class="fas fa-seedling d-block mt-2 text-success"></i>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card border-info shadow-sm hover-grow">
                    <div class="card-body text-center py-4">
                        <h2 class="text-info mb-0">{{ tech_count }}</h2>
                        <small class="text-muted">种植技术</small>
                        <i class="fas fa-book-open d-block mt-2 text-info"></i>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card border-warning shadow-sm hover-grow">
                    <div class="card-body text-center py-4">
                        <h2 class="text-warning mb-0">{{ user_count }}</h2>
                        <small class="text-muted">注册用户</small>
                        <i class="fas fa-users d-block mt-2 text-warning"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 实时天气与用户入口 -->
        <div class="row g-4 mb-4">
            <div class="col-md-8">
                <div class="card shadow-sm hover-grow">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-cloud-sun me-2"></i>赣州天气
                        <small class="float-end">更新于 {{ update_time }}</small>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-4 text-center">
                                <div class="display-4">{{ temperature }}℃</div>
                            </div>
                            <div class="col-8">
                                <div class="weather-details">
                                    <div class="alert weather-alert mb-0">
                                        <div class="weather-icon">
                                            <img src="{% static 'white/'|add:icon_night %}" alt="Night Icon" width="40"
                                                 height="40" class="text-warning">
                                        </div>
                                        <div class="mt-2">
                                            <small>湿度 {{ humidity }}% | 风速 {{ wind_speed }}km/h</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 用户快速入口 -->
            <div class="col-md-4">
                <div class="card shadow-sm hover-grow">
                    <div class="card-body">
                        <h5 class="text-center mb-4">{% if user.is_authenticated %}欢迎回来，{{ user.username }}
                            ！{% else %}请登录！{% endif %}</h5>
                        <div class="d-grid gap-2">
                            {% if user.is_authenticated %}
                                <a href="{% url 'orange:creat' %}" class="btn btn-success">
                                    <i class="fas fa-plus-circle me-2"></i>新品种创建
                                </a>
                                <a href="" class="btn btn-outline-success">
                                    <i class="fas fa-heart me-2"></i>我的收藏
                                </a>
                                <a href="" class="btn btn-outline-info">
                                    <i class="fas fa-comments me-2"></i>专家咨询
                                </a>
                            {% else %}
                                <a href="{% url 'user:login' %}" class="btn btn-success">
                                    <i class="fas fa-sign-in-alt me-2"></i>登录
                                </a>
                                <a href="{% url 'user:register' %}" class="btn btn-outline-success">
                                    <i class="fas fa-user-plus me-2"></i>注册
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最新内容展示 -->
        <div class="row g-4 mb-4">
            <!-- 最新品种 -->
            <div class="col-md-6">
                <div class="card shadow-sm hover-grow">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-seedling me-2"></i>最新品种
                        <a href="{% url 'orange:list' %}" class="btn btn-light btn-sm float-end">更多</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            {% for variety in last_variety %}
                                <a href="{% url 'orange:detail' variety.id %}"
                                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3">
                                    <div>
                                        <h6 class="mb-0">{{ variety.name }}</h6>
                                        <small class="text-muted">
                                            {% if variety.scientific_name %}{{ variety.scientific_name }}{% else %}
                                                暂无学名{% endif %}</small>
                                    </div>
                                    <span class="badge bg-secondary">{{ variety.create_time|date:"m-d" }}</span>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 最新农技文章 -->
            <div class="col-md-6">
                <div class="card shadow-sm hover-grow">
                    <div class="card-header bg-info text-white">
                        <i class="fas fa-book-open me-2"></i>最新农技
                        <a href="" class="btn btn-light btn-sm float-end">更多</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            {% for article in tech_articles %}
                                <a href="{% url 'article:detail' article.id %}"
                                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3">
                                    <div>
                                        <h6 class="mb-0">{{ article.title }}</h6>
                                        <small class="text-muted">{{ article.author.username }}</small>
                                    </div>
                                    <span class="badge bg-secondary">{{ article.update_time|date:"m-d" }}</span>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 平台服务信息 -->
        <div class="card shadow-sm mt-4">
            <div class="card-footer text-center bg-light">
                <div class="row g-4">
                    <div class="col-md-4">
                        <h6><i class="fas fa-phone-alt me-2"></i>技术支持</h6>
                        <p class="mb-0">0797-12345678</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-map-marker-alt me-2"></i>服务中心</h6>
                        <p class="mb-0">赣州市农业技术推广站</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-clock me-2"></i>服务时间</h6>
                        <p class="mb-0">08:30-17:30（工作日）</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}