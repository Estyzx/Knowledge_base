{% extends 'base.html' %}

{% block title %}
    {{ variety.name }}
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/css/variety_detail.css">
{% endblock %}


{% block main %}
    <div class="container mt-3">
        <nav aria-label="breadcrumb" class="mb-4 animate-fadeInUp">
            <ol class="breadcrumb glass-card py-3 px-4 shadow-sm">
                <li class="breadcrumb-item">
                    <a href="{% url 'orange:home' %}" class="text-success">
                        <i class="fas fa-home fa-fw"></i> 首页
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'orange:list' %}" class="text-success">
                        <i class="fas fa-book fa-fw"></i> 所有品种
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <i class="fas fa-file-alt fa-fw"></i> {{ variety.name|truncatechars:15 }}
                </li>
            </ol>
        </nav>
        <div class="row g-4">
            <!-- 左侧：主体信息 -->
            <div class="col-lg-8">
                <div class="d-flex justify-content-between mb-4 animate-fadeInUp delay-1">
                    {% if user.is_authenticated %}
                        <a href="{% url 'orange:edit' variety.id %}"
                           class="btn btn-primary btn-sm rounded-pill shadow-hover">
                            <i class="fas fa-edit me-1"></i>编辑
                        </a>
                        {% else %}
                        <span></span>
                    {% endif %}
                    <form method="post" action="{% url 'orange:detail' variety.id %}">
                        {% csrf_token %}
                        {% if user.is_authenticated %}
                            {% if user in variety.favorite_user.all %}
                                <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-hover">
                                    <i class="fas fa-heart me-1"></i> 取消收藏
                                </button>
                            {% else %}
                                <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill shadow-hover">
                                    <i class="fas fa-heart me-1"></i> 收藏
                                </button>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'user:login' %}" class="btn btn-outline-danger btn-sm rounded-pill shadow-hover">
                                <i class="fas fa-heart me-1"></i> 登录后收藏
                            </a>
                        {% endif %}
                    </form>
                </div>
                <!-- 基本信息卡片 -->
                <div class="glass-card mb-4 animate-fadeInUp delay-2">
                    <div class="card-header bg-orange-gradient text-white py-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h1 class="variety-title mb-0">{{ variety.name }}</h1>
                            <div class="icon-container">
                                <i class="fas fa-leaf fa-2x"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-4">
                        <!-- 基础信息行 -->
                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <div class="info-card bg-light-20 stat-item">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-container" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light))">
                                            <i class="fas fa-flask"></i>
                                        </div>
                                        <div>
                                            <span class="data-label">学名</span>
                                            <h4 class="data-value">{{ variety.scientific_name|default:"-" }}</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card bg-light-20 stat-item">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-container" style="background: linear-gradient(135deg, var(--primary-teal), var(--info-color))">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div>
                                            <span class="data-label">原产地</span>
                                            <h4 class="data-value">{{ variety.origin|default:"-" }}</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 品种描述 -->
                        <div class="desc-section glass-card p-4 rounded-3 animate-fadeInUp delay-3">
                            <h5 class="text-uppercase mb-3" style="background: linear-gradient(120deg, var(--primary-orange), var(--accent-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                <i class="fas fa-book-open me-2"></i>品种描述
                            </h5>
                            <div class="desc-content" style="text-indent: 2em; line-height: 1.8; font-size: 1.05rem;">
                                {{ variety.description|default:"暂无详细描述"|linebreaks }}
                            </div>
                        </div>
                    </div>

                    <!-- 卡片页脚 -->
                    <div class="card-footer glass-card border-top-0 p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <span class="badge bg-light text-dark me-2 p-2 shadow-sm">
                                    <i class="fas fa-history me-1 text-primary"></i>{{ variety.update_time|date:"Y/m/d H:i" }}
                                </span>
                                <span class="badge bg-light text-dark p-2 shadow-sm">
                                    <i class="fas fa-heart me-1 text-danger"></i>{{ variety.favorite_user.count }} 人收藏
                                </span>
                            </div>
                            <div class="d-flex gap-2">
                                <a href="{% url 'orange:list' %}"
                                   class="btn btn-outline-secondary btn-sm rounded-pill px-3 shadow-hover">
                                    <i class="fas fa-arrow-left me-1"></i>返回列表
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 技术信息卡片组 -->
                <div class="row g-4 animate-fadeInUp delay-4">
                    <!-- 生态适应性 -->
                    <div class="col-md-6">
                        <div class="glass-card h-100">
                            <div class="card-header bg-teal-gradient text-white py-3">
                                <div class="d-flex align-items-center">
                                    <div class="icon-container me-3" style="background: linear-gradient(135deg, var(--primary-teal), #4ecdc4);">
                                        <i class="fas fa-globe-asia"></i>
                                    </div>
                                    <h5 class="mb-0">生态适应性</h5>
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <div class="tag-container">
                                    {% for soil in variety.soil_preference.all %}
                                        <a href="{% url 'orange:soil_detail' soil.id %}" class="text-decoration-none">
                                            <span class="feature-tag" style="background-color: var(--soil-color); color: white;">
                                                <i class="fas fa-seedling"></i>{{ soil.name }}
                                            </span>
                                        </a>
                                    {% empty %}
                                        <div class="alert alert-light mb-0 py-3 text-center w-100 shadow-sm">
                                            <i class="fas fa-info-circle me-2 text-info"></i>暂无土壤适应性数据
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 种植技术 -->
                    <div class="col-md-6">
                        <div class="glass-card h-100">
                            <div class="card-header bg-teal-gradient text-white py-3">
                                <div class="d-flex align-items-center">
                                    <div class="icon-container me-3" style="background: linear-gradient(135deg, var(--primary-green), #6dd5a1);">
                                        <i class="fas fa-tractor"></i>
                                    </div>
                                    <h5 class="mb-0">种植技术</h5>
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <div class="tag-container">
                                    {% for tech in variety.planting_tech.all %}
                                        <a href="{% url 'orange:tech_detail' tech.id %}" class="text-decoration-none">
                                            <span class="feature-tag" style="background: linear-gradient(135deg, var(--primary-green), #6dd5a1); color: white;">
                                                <i class="fas fa-cog"></i>{{ tech.name }}
                                            </span>
                                        </a>
                                    {% empty %}
                                        <div class="alert alert-light mb-0 py-3 text-center w-100 shadow-sm">
                                            <i class="fas fa-info-circle me-2 text-info"></i>暂无关联技术
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 病虫害 -->
                    <div class="col-md-12">
                        <div class="glass-card h-100">
                            <div class="card-header bg-danger-gradient text-white py-3">
                                <div class="d-flex align-items-center">
                                    <div class="icon-container me-3" style="background: linear-gradient(135deg, var(--danger-color), #ff6b6b);">
                                        <i class="fas fa-bug"></i>
                                    </div>
                                    <h5 class="mb-0">病虫害防治</h5>
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <div class="tag-container">
                                    {% for disease in variety.pest.all %}
                                        <a href="{% url 'orange:pest_detail' disease.id %}" class="text-decoration-none">
                                            <span class="feature-tag" style="background: linear-gradient(135deg, var(--danger-color), #ff6b6b); color: white;">
                                                <i class="fas fa-skull-crossbones"></i>{{ disease.name }}
                                            </span>
                                        </a>
                                    {% empty %}
                                        <div class="alert alert-light mb-0 py-3 text-center w-100 shadow-sm">
                                            <i class="fas fa-info-circle me-2 text-info"></i>当前无病虫害记录
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 右侧：特性信息 -->
            <div class="col-lg-4">
                <!-- 生长特性 -->
                <div class="glass-card mb-4 animate-fadeInUp delay-2">
                    <div class="card-header bg-primary text-white py-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-container me-3" style="background: linear-gradient(135deg, var(--primary-color), #4e7cff);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5 class="mb-0">生长特性</h5>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="growth-stats">
                            <div class="stat-item d-flex justify-content-between align-items-center p-3 mb-4 bg-light rounded-3">
                                <div>
                                    <span class="data-label">生长周期</span>
                                    <h3 class="data-value">{{ variety.growth_cycle }} <small class="text-muted">天</small></h3>
                                </div>
                                <div class="icon-container" style="background: linear-gradient(135deg, var(--primary-color), #4e7cff);">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                            </div>

                            <div class="stat-item d-flex justify-content-between align-items-center p-3 mb-4 bg-light rounded-3">
                                <div>
                                    <span class="data-label">需冷量 (≤7.2℃)</span>
                                    <h3 class="data-value">{{ variety.chill_requirement }} <small class="text-muted">小时</small></h3>
                                </div>
                                <div class="icon-container" style="background: linear-gradient(135deg, var(--info-color), #5dceeb);">
                                    <i class="fas fa-thermometer-half"></i>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 text-center stat-item">
                                        <span class="data-label">耐寒性</span>
                                        <div class="tolerance-bar tolerance-{{ variety.cold_tolerance|lower }}">
                                            <div class="progress"></div>
                                        </div>
                                        <span class="badge bg-info mt-2 px-3 py-2">{{ variety.get_cold_tolerance_display }}</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 text-center stat-item">
                                        <span class="data-label">耐旱性</span>
                                        <div class="tolerance-bar tolerance-{{ variety.drought_tolerance|lower }}">
                                            <div class="progress"></div>
                                        </div>
                                        <span class="badge bg-warning mt-2 px-3 py-2">{{ variety.get_drought_tolerance_display }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 果实特性 -->
                <div class="glass-card animate-fadeInUp delay-3">
                    <div class="card-header bg-purple-gradient text-white py-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-container me-3" style="background: linear-gradient(135deg, var(--primary-purple), #9c8fff);">
                                <i class="fas fa-apple-alt"></i>
                            </div>
                            <h5 class="mb-0">果实特性</h5>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="fruit-stats">
                            <div class="row g-4">
                                <div class="col-12">
                                    <div class="stat-item d-flex justify-content-between align-items-center p-4 bg-light rounded-3">
                                        <div>
                                            <span class="data-label">平均单果重</span>
                                            <h3 class="data-value">{{ variety.fruit_weight }}<small class="text-muted">g</small></h3>
                                        </div>
                                        <div class="icon-container" style="background: linear-gradient(135deg, var(--primary-purple), #9c8fff);">
                                            <i class="fas fa-weight-hanging"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="stat-item p-4 bg-light rounded-3 text-center h-100">
                                        <div class="icon-container mx-auto mb-3" style="background: linear-gradient(135deg, var(--primary-orange), #ffb347);">
                                            <i class="fas fa-wine-bottle"></i>
                                        </div>
                                        <span class="data-label">可溶固形物</span>
                                        <h3 class="data-value mt-2">{{ variety.brix }}<small class="text-muted">%</small></h3>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="stat-item p-4 bg-light rounded-3 text-center h-100">
                                        <div class="icon-container mx-auto mb-3" style="background: linear-gradient(135deg, var(--primary-cyan), #5dceeb);">
                                            <i class="fas fa-ruler-vertical"></i>
                                        </div>
                                        <span class="data-label">果皮厚度</span>
                                        <h3 class="data-value mt-2">{{ variety.peel_thickness }}<small class="text-muted">mm</small></h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}